---
import { Image } from "astro:assets";
import IconLogo from "~/assets/images/icons/logo.svg";
import CarHighlights from "~/components/car/CardHighlights.astro";
import CardPrice from "~/components/car/CardPrice.astro";
import type { Car } from "~/types";

const { car, index = 0 } = Astro.props as { car: Car; index?: number };

const make = car.data.general.make?.toLowerCase() ?? "";
const model = car.data.general.model?.toLowerCase() ?? "";
const type = car.data.general.type?.toLowerCase() ?? "";
const bodyType = car.data.general.bodyType?.toLowerCase() ?? "";
const fuelType = car.data.efficiency?.fuelType?.toLowerCase() ?? "";
const transmission = car.data.technical?.transmission?.toLowerCase() ?? "";
const color = car.data.exterior?.color?.toLowerCase() ?? "";
const condition = car.data.general.condition?.toLowerCase() ?? "";
const availability = car.data.general.availability?.toLowerCase() ?? "";
const year = car.data.history?.year ?? "";
const mileage = car.data.history?.mileage ?? "";
const regularPrice = car.data.general.price ?? 0;
const salePrice = car.data.general.salePrice ?? "";
const effectivePrice = car.data.general.salePrice ?? car.data.general.price ?? 0;
const searchBlob = [
	car.data.title,
	car.data.general.make,
	car.data.general.model,
	car.data.general.bodyType,
	car.data.general.type,
	car.data.excerpt,
	car.data.options?.join(" ") ?? "",
	car.data.exterior?.color ?? "",
	car.data.general.condition ?? "",
]
	.join(" ")
	.toLowerCase();
// console.log(car);

---

<li
	data-car-id={car.id}
	data-car-index={index}
	data-car-make={make}
	data-car-model={model}
	data-car-type={type}
	data-car-body-type={bodyType}
	data-car-fuel-type={fuelType}
	data-car-transmission={transmission}
	data-car-color={color}
	data-car-condition={condition}
	data-car-available={availability}
	data-car-year={year}
	data-car-mileage={mileage}
	data-car-price={effectivePrice}
	data-car-regular-price={regularPrice}
	data-car-sale-price={salePrice}
	data-car-on-sale={salePrice ? "true" : "false"}
	data-car-search={searchBlob}
	class="card-car bg-white shadow overflow-hidden xxl:transition xxl:border-transparent xxl:border-r-4 hover:lg:border-yellow-300"
>
	<a href={`/view/${car.id}`} class="relative isolate flex flex-col gap-8 xxl:flex-row">
		<div class="relative aspect-[4/3] xxl:w-72 lg:shrink-0 ribbon">
			{
				car.data.image ? (
					<Image
						src={car.data.image}
						alt={car.data.imageAlt}
						class="absolute inset-0 size-full bg-gray-50 object-cover"
					/>
				) : (
					<div class="absolute inset-0 text-gray-400 size-full bg-gray-100 flex flex-col gap-4 items-center justify-center">
						<IconLogo class="h-24" />
						<span class="text-gray-400 font-bold italic">Pr√≥ximamente</span>
					</div>
				)
			}
		</div>
		<div class="flex flex-col items-start lg:py-4 grow max-xxl:px-4 max-lg:pb-8">
			<div class="relative xxl:flex xxl:items-start xxl:gap-4 xxl:justify-between w-full">
				<div class="mb-4 lg:mb-6">
					<h2 class="h5 line-clamp-2">
						{car.data.title}
						{
							car.data.general.type && (
								<span class="text-base max-xl:block xl:ml-2 text-gray-800 font-normal align-middle">
									{car.data.general.type}
								</span>
							)
						}
					</h2>
					<p class="text-base mt-2 line-clamp-3">{car.data.excerpt}</p>
					{
						car.data.options && car.data.options.length > 0 && (
							<p class="text-base text-gray-400 mt-3 line-clamp-1">
								{car.data.options.join(", ")}
							</p>
						)
					}
				</div>
				<CardPrice data={car.data.general} />
			</div>
			<div class="mt-auto lg:mb-4">
				<CarHighlights data={car.data} />
			</div>
		</div>
	</a>
</li>
